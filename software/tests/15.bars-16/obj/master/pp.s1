;
; Generated with ap65 v 1.00
;
.setcpu     "65816"
.smart      on
.autoimport on
.case       on
.importzp   sp, sreg, regsave, regbank
.importzp   tmp1, tmp2, tmp3, tmp4
.importzp   ptr1, ptr2, ptr3, ptr4
;
.zeropage
zpp =  $90
zptr =  zpp+0
zcmd =  zpp+2
zflg =  zpp+3
zdst =  zpp+4
zsiz =  zpp+6
zsrc =  zpp+8
.code
__pp_cmd_ptr:
.word 0
pp_save_via_ier:
.byte 0
pp_save_via_acr:
.byte 0
pp_save_via_pcr:
.byte 0
pp_save_via_ddra:
.byte 0
pp_save_via_ddrb:
.byte 0
pp_save_via_a:
.byte 0
pp_save_via_b:
.byte 0
pp_save_y: 
.byte 0
__pp_send:
php
sei
sty pp_save_y
jsr pp_setup_master
lda __pp_cmd_ptr
sta zptr
lda __pp_cmd_ptr+1
sta zptr+1
ldy #$00
txl_1:
lda (zptr),y
sta zcmd,y
iny
cpy #$08
bne txl_1
ldy #$07
lda #$55
tx_syn:
jsr pp_out_put_byte
dey
bne tx_syn
lda #$aa
jsr pp_out_put_byte
ldy #$00
tx_hdr:
lda (zptr),y
jsr pp_out_put_byte
iny
cpy #$06
bne tx_hdr
ldy #$00
tx_cont:
lda (zsrc),y
jsr pp_out_put_byte
inc zsrc
bne txs_1
inc zsrc+1
txs_1:
dec zsiz
bne tx_cont
lda zsiz+1
beq txs_2
dec zsiz+1
jmp tx_cont
txs_2:
jsr pp_reset
ldy pp_save_y
plp
rts
pp_setup_master:
lda $030e
sta pp_save_via_ier
lda #%01111111
sta $030e
sta $030d
lda $0300
sta pp_save_via_b
ora #%00010000
sta $0300
lda $0302
sta pp_save_via_ddrb
ora #%00010000
sta $0302
lda $030c
sta pp_save_via_pcr
ora #%00000001
sta $030c
lda $0301
sta pp_save_via_a
lda $0303
sta pp_save_via_ddra
lda #%11111111
sta $0303
sta $0301
lda $030b
sta pp_save_via_acr
and #%11111100
sta $030b
jsr _set_pp_out
jsr _set_pp_on
rts
pp_out_put_byte:
pha
sta $0301
lda $0300
and #%11101111
sta $0300
lda #(1<<1)
lp_opb:
bit $030d
beq lp_opb
lda $0300
ora #%00010000
sta $0300
pla
rts
pp_out_setup_receive:
rts
pp_out_get_byte:
rts
pp_reset:
jsr _set_pp_off
jsr _set_pp_out
lda pp_save_via_b
sta $0300
lda pp_save_via_ddrb
sta $0302
lda pp_save_via_a
sta $0301
lda pp_save_via_ddra
sta $0303
lda pp_save_via_pcr
sta $030c
lda pp_save_via_acr
sta $030b
lda #%01111111
sta $030e
sta $030d
lda pp_save_via_ier
ora #$80
sta $030e
rts
.export __pp_cmd_ptr
.export __pp_send
